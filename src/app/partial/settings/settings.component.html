<p class="page-heading">settings</p>


<div class="row">
    <div class="col-sm-12">
        <div class="display-bar">
            <ul class="nav nav-pills mb-0" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button type="button" class="nav-link active" id="pills-notifications-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-notifications" type="button" role="tab"
                        aria-controls="pills-notifications" aria-selected="true" (click)="showvehicleNotification('Notifications')">Notifications</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button type="button" class="nav-link" id="pills-change-password-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-change-password" type="button" role="tab"
                        aria-controls="pills-change-password" aria-selected="false" (click)="showvehicleNotification('ChangePassword')">Change Password</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button type="button" class="nav-link" id="pills-vehicle-notifications-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-vehicle-notifications" type="button" role="tab"
                        aria-controls="pills-vehicle-notifications" aria-selected="false" (click)="showvehicleNotification('VehicleNotifications')">Vehicle Notifications</button>
                </li>
                <div class="vr mx-4" *ngIf="vehicleNotificationFlag"></div>
                <div class="d-flex justify-content-between align-items-center small" *ngIf="vehicleNotificationFlag">
                    <span class="me-4">Total Vehicle Notifications : </span> <h6 class="mb-0">{{this.totalVehicleNotificationsData}}</h6>
                </div>
            </ul>
        </div>
        <div class="card border-0 rounded">
            <div class="card-body">
                <div class="tab-content" id="pills-tabContent">
                    <div class="tab-pane fade show active" id="pills-notifications" role="tabpanel"
                        aria-labelledby="pills-notifications-tab" tabindex="0">
                            <div class="row">
                                <div class="col-sm-6" *ngFor="let alert of notificationsData">
                                    <ul class="list-group list-group-flush" >
                                        <ng-container *ngIf="alert?.alertType=='overspeed' || alert?.alertType=='tilt' ; else template">
                                            <li class="list-group-item border-bottom">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span class="noti-title text-capitalize">{{alert?.alertType}}</span>
                                                    <div class="d-flex w-75 justify-content-between align-items-center ">
                                                        <mat-slider [tickInterval]="getSliderTickInterval()" class="w-100 ms-2" ></mat-slider>
                                                        <span class="badge bg-extra-light text-dark p-2"><label>{{value}}
                                                                {{alert?.alertType=='overspeed'?'kmph':'degree'}}</label></span>
                                                    </div>
                                                    <div class="form-check form-switch">
                                                        <mat-slide-toggle  [id]="alert?.alertType" [(ngModel)]="alert.isNotification" 
                                                    (change)="switchNotification(alert)"></mat-slide-toggle>
                                                    </div>
                                                </div>
                                            </li>
                                        </ng-container>
                                        <ng-template #template>
                                            <li class="list-group-item d-flex justify-content-between align-items-center border-bottom"
                                                *ngIf="!alert?.isVisibleToOfficer">
                                                <span class="noti-title  text-capitalize">{{alert?.alertType}}</span>
                                                <div class="form-check form-switch">
                                                    <mat-slide-toggle [id]="alert?.alertType" [(ngModel)]="alert.isNotification"
                                                        (change)="switchNotification(alert)"></mat-slide-toggle>
                                                </div>
                                            </li>
                                        </ng-template>
                                    </ul>
                                </div>
                            </div>
                    </div>


                    <div class="tab-pane fade" id="pills-change-password" role="tabpanel"
                        aria-labelledby="pills-change-password-tab" tabindex="0">
                        <div class="row justify-content-between">
                            <form [formGroup]="changePassForm">
                                <div class="col-sm-4 form-container">
                                    <mat-form-field [appearance]="config.matFormField" class="w-100 form-group">
                                        <mat-label>Current password</mat-label>
                                        <input matInput [type]="CurrentPasswordHide ? 'password' : 'text'" autocomplete="nope"
                                            formControlName="currentPwd"
                                            [ngClass]="{ 'is-invalid':fpass['currentPwd'].errors }">
                                        <button type="button" mat-icon-button matSuffix (click)="CurrentPasswordHide = !CurrentPasswordHide"
                                            [attr.aria-label]="'Hide password'" [attr.aria-pressed]="CurrentPasswordHide">
                                            <mat-icon>{{CurrentPasswordHide ? 'visibility_off' : 'visibility'}}</mat-icon>
                                        </button>
                                        <mat-error>
                                            <span *ngIf="fpass['currentPwd'].errors?.['required']"
                                                class="text-danger">Current Password is required</span>
                                            <span *ngIf="fpass['currentPwd'].errors?.['pattern']"
                                                class="text-danger">Current Password is invalid format</span>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field [appearance]="config.matFormField" class="w-100 form-group">
                                        <mat-label>New password</mat-label>
                                        <input matInput [type]="newPasswordHide ? 'password' : 'text'" formControlName="newPwd"
                                            [ngClass]="{ 'is-invalid':fpass['newPwd'].errors }">
                                        <button type="button" mat-icon-button matSuffix (click)="newPasswordHide = !newPasswordHide"
                                            [attr.aria-label]="'Hide password'" [attr.aria-pressed]="newPasswordHide">
                                            <mat-icon>{{newPasswordHide ? 'visibility_off' : 'visibility'}}</mat-icon>
                                        </button>
                                        <mat-error>
                                            <span *ngIf="fpass['newPwd'].errors?.['required']" class="text-danger">New
                                                Password is required</span>
                                            <span *ngIf="fpass['newPwd'].errors?.['pattern']" class="text-danger">New
                                                Password is invalid format</span>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field [appearance]="config.matFormField" class="w-100 form-group">
                                        <mat-label>Retype password</mat-label>
                                        <input matInput [type]="retypePasswordHide ? 'password' : 'text'" formControlName="reTypePwd"
                                            [ngClass]="{'is-invalid':fpass['reTypePwd'].errors}">
                                        <button type="button" mat-icon-button matSuffix (click)="retypePasswordHide = !retypePasswordHide"
                                            [attr.aria-label]="'Hide password'" [attr.aria-pressed]="retypePasswordHide">
                                            <mat-icon>{{retypePasswordHide ? 'visibility_off' : 'visibility'}}</mat-icon>
                                        </button>
                                        <mat-error>
                                            <span *ngIf="fpass['reTypePwd'].errors?.['required']"
                                                class="text-danger">ReType Password is required</span>
                                            <span *ngIf="fpass['reTypePwd'].errors?.['pattern']" class="text-danger">New
                                                Password is invalid format</span>
                                        </mat-error>
                                    </mat-form-field>
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-main" (click)="onChangePwd()">Submit</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>


                    <div class="tab-pane fade" id="pills-vehicle-notifications" role="tabpanel"
                        aria-labelledby="pills-vehicle-notifications-tab" tabindex="0">
                        <div class="row justify-content-between">
                            <div class="col-sm-12">
                                <div class="card form-card">
                                    <div class="card-header">
                                        <div class="row justify-content-between">
                                            <div class="col-sm-6">
                                                <div class="row align-items-center">
                                                    <div class="col-sm-auto">
                                                        Vehicle Notifications List
                                                    </div>
                                                    <div class="col-sm-8">
                                                        <div class="input-group">
                                                            <input type="text" class="form-control" placeholder="Search"
                                                                [formControl]="searchContent">
                                                            <div class="input-group-text" *ngIf="!searchContent.value">
                                                                <i class="fa-solid fa-magnifying-glass"></i></div>
                                                            <div class="input-group-text" *ngIf="searchContent.value"><i
                                                                    class="fa fa-times"
                                                                    (click)="searchContent.reset()"></i></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                          <table mat-table [dataSource]="vehiclenotificationsData" multiTemplateDataRows 
                                            class="table dashboard-table">
                                            <ng-container matColumnDef="SR.NO" >
                                                <th mat-header-cell *matHeaderCellDef style="width:80px !important;"> SR.NO </th>
                                                <!-- <td mat-cell matCellDef="let element let i=index">{{((pageNumber + 1)  10 + i + 1)-20}} </td> -->
                                                <td mat-cell *matCellDef="let element; let j=index">{{element.rowNumber}}</td>
                                            </ng-container>
                                            <ng-container matColumnDef="vehicle-icon">
                                                <th mat-header-cell *matHeaderCellDef style="width:50px !important;"></th>
                                                <td mat-cell *matCellDef="let element"> 
                                                    <img src="assets/images/Vehicle-profile.svg" style="width:30px">    
                                                </td>
                                            </ng-container>
                                            <ng-container matColumnDef="VEHICLE NO">
                                                <th mat-header-cell *matHeaderCellDef style="width:150px !important;"> VEHICLE NO.</th>
                                                <td mat-cell *matCellDef="let element"> {{element.vehicleNo}} </td>
                                            </ng-container>
                                            <ng-container matColumnDef="VEHICLE TYPE">
                                                <th mat-header-cell *matHeaderCellDef>VEHICLE TYPE </th>
                                                <td mat-cell *matCellDef="let element"> {{element.vehTypeName}} </td>
                                            </ng-container>
                                            <ng-container matColumnDef="expand">
                                                <th mat-header-cell *matHeaderCellDef aria-label="row actions" style="width:50px">&nbsp;
                                                </th>
                                                <td mat-cell *matCellDef="let element" style="width:50px">
                                                    <button mat-icon-button aria-label="expand row"
                                                        (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                                                        <mat-icon *ngIf="expandedElement !== element">
                                                            keyboard_arrow_down</mat-icon>
                                                        <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up
                                                        </mat-icon>
                                                    </button>
                                                </td>
                                            </ng-container>

                                            <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                                            <ng-container matColumnDef="expandedDetail">
                                                <td mat-cell *matCellDef="let element"
                                                    [attr.colspan]="columnsToDisplayWithExpand.length">
                                                    <div class="example-element-detail"
                                                        [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                                        <div class="row">
                                                            <div class="col-sm-6" *ngFor="let alert of vehiclesAlertsData">
                                                                <ul class="list-group list-group-flush" >
                                                                    <ng-container *ngIf="alert?.alertType=='overspeed' || alert?.alertType=='tilt' ; else template">
                                                                        <li class="list-group-item border-bottom">
                                                                            <div class="d-flex justify-content-between align-items-center">
                                                                                <span class="noti-title text-capitalize">{{alert?.alertType}}</span>
                                                                                <div class="d-flex w-75 justify-content-between align-items-center">
                                                                                    <mat-slider [tickInterval]="getSliderTickInterval()" class="w-100" ></mat-slider>
                                                                                    <span class="badge bg-extra-light text-dark p-2"><label>{{value}}
                                                                                            {{alert?.alertType=='overspeed'?'kmph':'degree'}}</label></span>
                                                                                </div>
                                                                                <div class="form-check form-switch">
                                                                                    <mat-slide-toggle  [id]="alert?.alertType" [(ngModel)]="alert.isNotification" 
                                                                               ></mat-slide-toggle>
                                                                               <!-- (change)="switchNotification(alert)" -->
                                                                                </div>
                                                                            </div>
                                
                                                                        </li>
                                                                    </ng-container>
                                                                    <ng-template #template>
                                                                        <li class="list-group-item d-flex justify-content-between align-items-center border-bottom"
                                                                            *ngIf="!alert?.isVisibleToOfficer">
                                                                            <span class="noti-title  text-capitalize">{{alert?.alertType}}</span>
                                                                            <div class="form-check form-switch">
                                                                                <mat-slide-toggle [id]="alert?.alertType" [(ngModel)]="alert.isNotification"
                                                                                   ></mat-slide-toggle>
                                                                                   <!-- (change)="switchNotification(alert)" -->
                                                                            </div>
                                                                        </li>
                                                                    </ng-template>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
                                            <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;"
                                                class="example-element-row"
                                                [class.example-expanded-row]="expandedElement === element"
                                                (click)="(expandedElement = expandedElement === element ? null : element); getVehiclesAlertsData(element.vehicleNo)">
                                            </tr>
                                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']"
                                                class="example-detail-row"></tr>
                                        </table>
                                        <div *ngIf="!vehiclenotificationsData.length">
                                            <div class="alert alert-danger text-center py-2">
                                                No data found
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>